---
import Layout from '../layouts/Layout.astro';
import LanguageSwitcher from '../components/LanguageSwitcher';
import { readFileSync } from 'fs';
import { fileURLToPath, pathToFileURL } from 'url';
import { dirname, join } from 'path';
import { marked } from 'marked';

const title = 'Benchmark Details - Przeprogramowani Vibe Coded';
const description = 'Task prompt and evaluation criteria for the Przeprogramowani vibe coding benchmark';

// Get the current file path and work up to project root
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const srcDir = dirname(__dirname);
const websiteDir = dirname(srcDir);
const projectRoot = dirname(websiteDir);

const promptPath = join(projectRoot, 'benchmark', 'prompt.md');
const criteriaPath = join(projectRoot, 'benchmark', 'criteria.md');

let promptContent = '';
let criteriaContent = '';

try {
  const promptMd = readFileSync(promptPath, 'utf-8');
  promptContent = marked(promptMd);
} catch (e: any) {
  console.error('Error loading prompt.md:', e.message);
  promptContent = '<p class="text-red-600">Error loading prompt.md</p>';
}

try {
  const criteriaMd = readFileSync(criteriaPath, 'utf-8');
  criteriaContent = marked(criteriaMd);
} catch (e: any) {
  console.error('Error loading criteria.md:', e.message);
  criteriaContent = '<p class="text-red-600">Error loading criteria.md</p>';
}

// English translation for prompt only
const promptContentEN = marked(
  'Create a modern and responsive website for the Przeprogramowani.pl project. Download necessary information about our activities online. It should contain pages About Us, Podcast (with latest episodes), YouTube (with latest videos), section for courses Opanuj Frontend, Opanuj TypeScript and 10xDevs (in hero). Stack is Astro, React and Tailwind. Ready for deployment on Cloudflare.'
);
---

<Layout title={title} description={description}>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-8">Benchmark Details</h1>

    <!-- Prompt Section -->
    <div class="mb-12">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-3xl font-bold text-gray-900" id="prompt-title">Task Prompt</h2>
        <div id="language-switcher-container"></div>
      </div>
      <div class="prose prose-sm max-w-none bg-white p-6 rounded-lg border border-gray-200" id="prompt-content">
        <Fragment set:html={promptContent} />
      </div>
    </div>

    <!-- Criteria Section -->
    <div class="mb-12">
      <h2 class="text-3xl font-bold text-gray-900 mb-6" id="criteria-title">Evaluation Criteria</h2>
      <div class="prose prose-sm max-w-none bg-white p-6 rounded-lg border border-gray-200" id="criteria-content">
        <Fragment set:html={criteriaContent} />
      </div>
    </div>
  </div>
</Layout>

<script define:vars={{ promptContent, promptContentEN }}>
  // Language switcher component
  const container = document.getElementById('language-switcher-container');

  const switcherHTML = `
    <div class="flex gap-2">
      <button id="btn-pl" class="px-3 py-1 rounded text-sm font-semibold transition-all bg-gray-900 text-white">
        PL
      </button>
      <button id="btn-en" class="px-3 py-1 rounded text-sm font-semibold transition-all bg-gray-100 text-gray-900 hover:bg-gray-200">
        EN
      </button>
    </div>
  `;

  container.innerHTML = switcherHTML;

  let currentLang = 'PL';

  const updateLanguage = (lang) => {
    currentLang = lang;
    const btnPL = document.getElementById('btn-pl');
    const btnEN = document.getElementById('btn-en');
    const promptContentEl = document.getElementById('prompt-content');

    // Update button styles
    if (lang === 'PL') {
      btnPL.className = 'px-3 py-1 rounded text-sm font-semibold transition-all bg-gray-900 text-white';
      btnEN.className = 'px-3 py-1 rounded text-sm font-semibold transition-all bg-gray-100 text-gray-900 hover:bg-gray-200';
      promptContentEl.innerHTML = promptContent;
    } else {
      btnPL.className = 'px-3 py-1 rounded text-sm font-semibold transition-all bg-gray-100 text-gray-900 hover:bg-gray-200';
      btnEN.className = 'px-3 py-1 rounded text-sm font-semibold transition-all bg-gray-900 text-white';
      promptContentEl.innerHTML = promptContentEN;
    }
  };

  document.getElementById('btn-pl').addEventListener('click', () => updateLanguage('PL'));
  document.getElementById('btn-en').addEventListener('click', () => updateLanguage('EN'));
</script>

<style is:global>
  html {
    background-color: white !important;
    color: #111827 !important;
  }

  body {
    background-color: white !important;
    color: #111827 !important;
  }

  .prose {
    color: #1f2937;
    background-color: transparent;
  }

  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    color: #111827;
    font-weight: 600;
    margin-top: 1.5em;
    margin-bottom: 0.5em;
  }

  .prose h1 {
    font-size: 2em;
  }

  .prose h2 {
    font-size: 1.5em;
  }

  .prose h3 {
    font-size: 1.25em;
  }

  .prose p {
    margin-bottom: 1em;
    line-height: 1.6;
    color: #1f2937;
  }

  .prose ul,
  .prose ol {
    margin-bottom: 1em;
    padding-left: 2em;
  }

  .prose li {
    margin-bottom: 0.5em;
    color: #1f2937;
  }

  .prose code {
    background-color: #f3f4f6;
    border-radius: 0.375rem;
    padding: 0.2em 0.4em;
    font-family: monospace;
    font-size: 0.9em;
    color: #dc2626;
  }

  .prose pre {
    background-color: #1f2937;
    color: #f3f4f6;
    padding: 1em;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin-bottom: 1em;
  }

  .prose pre code {
    color: inherit;
    background-color: transparent;
    padding: 0;
  }

  .prose blockquote {
    border-left: 4px solid #3b82f6;
    padding-left: 1em;
    margin-left: 0;
    color: #1f2937;
    font-style: italic;
    background-color: #f0f4f8;
    padding: 0.5em 0 0.5em 1em;
  }

  .prose strong {
    font-weight: 600;
    color: #111827;
  }

  .prose em {
    font-style: italic;
    color: #1f2937;
  }

  .prose a {
    color: #3b82f6;
    text-decoration: none;
  }

  .prose a:hover {
    text-decoration: underline;
  }

  .prose table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1em;
  }

  .prose th,
  .prose td {
    border: 1px solid #e5e7eb;
    padding: 0.75em;
    text-align: left;
    color: #1f2937;
  }

  .prose th {
    background-color: #f9fafb;
    font-weight: 600;
  }
</style>
